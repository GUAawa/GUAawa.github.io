<!--根据url动态获取内容-->
<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <title>被你发现了qwp</title>
</head>
<body>
    <div id="screen" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background-color:black;"></div> 
    <div id="light" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80vmin;height:80vmin;background:#fff;border-radius:50%"></div>
</body>
<script src="../tools/query.js"></script>
<script src="../tools/base64.js"></script>
<script src="../tools/textcc.js"></script>
<script src="../modules/crypto-js.js"></script>
<script src="../tools/crypto.js"></script>
<script src="../modules/forge.min.js"></script>
<script src="../tools/pigeon.js"></script>
<script>
    const encrypted_verification = 'U2FsdGVkX196Fw9e2s2OrJcsf0cbU3fcjoTXOTW6Nks='
    const hash_time = '3806734b256c27e41ec2c6bffa26d9e7' //correct time
    // const hash_time = 'ef50c335cca9f340bde656363ebd02fd' //1018
    const encrypted_morse = 'U2FsdGVkX18g60EDQyOUOFEGQBrxBldRvqJ27IgaBNRkWhDD2OwsAaui/PBooMWle7+GoCMaWKaBcq7G7o94maiguJxQtxs3Gib9fiU1oD1ZvN7rbrZp2VO8iq1g54louXYrgZcquBdEoa6NDXbYEWkK6M+ANHkWB5Dk6+C+tAakAMvbISR18DKBPm4N4o2UbxAQe4hG6EDFD3hrk2fcyn9yIgkktpAXVINKg3u60WUm4X60o/uZSDuJXqj0ufgrwRH75sYb2FMKCB1TrVsw0e9nQG5Jp3V2mshDS1kmrAeveXjON5Ctew=='
    function main(){
        const key = getQueryVariable("key")

        if(key == false){
            alert("你不该来此: 缺失的认证信息")
            return -3;
        }

        const verification = GUA_Crypto.decrypt(encrypted_verification,key)
        if(verification != "verified"){
            alert("你不该来此: 错误的认证信息")
            return -1;
        }
        const now = new Date();
        const time = (now.getMonth()+1).toString() + now.getDate().toString()
        const hash_now = CryptoJS.MD5(time).toString();
        console.log(time,hash_now)
        if(hash_now != hash_time){
            alert("你不该来此: 时候未到")
            return -2;
        }
        
        const key_time = key + time
        const morse = GUA_Crypto.decrypt(encrypted_morse,key_time)
        const light = document.getElementById("light")
        function display(i){
            light.style.backgroundColor = ((morse[i]=='=')?"white":"black")
            setTimeout(()=>{display((i+1)%morse.length)},150)
        }
        display(0);
    }
    main()
</script>
</html>